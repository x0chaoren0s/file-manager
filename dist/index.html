<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>文件管理器</title>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function W(e){return e.endsWith("/")?e:e.slice(0,e.lastIndexOf("/")+1)}const a={currentPathname:window.location.pathname,basePath:W(window.location.pathname),origin:window.location.origin,items:[],webdavCapable:!0,supportsPut:!1,supportsMove:!1,supportsDelete:!1};function B(e){return String(e).replace(/[&<>"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[t])}function j(e){if(e==null||isNaN(e))return"-";const t=["B","KB","MB","GB","TB"];let n=0,o=Number(e);for(;o>=1024&&n<t.length-1;)o/=1024,n++;return o.toFixed(o<10&&n>0?2:0)+" "+t[n]}function F(e){if(!e)return"-";const t=new Date(e);if(String(t)==="Invalid Date")return"-";const n=o=>String(o).padStart(2,"0");return`${t.getFullYear()}-${n(t.getMonth()+1)}-${n(t.getDate())} ${n(t.getHours())}:${n(t.getMinutes())}`}function I(e,t){return e.endsWith("/")||(e+="/"),e+t}function O(e){return e.split("/").map(t=>encodeURIComponent(t)).join("/").replace(/%2F/gi,"/")}function A(e,t){try{return new URL(e,t).pathname}catch{return e}}function V(e){const t=String(e||"").toLowerCase();return t.endsWith(".log")||t.endsWith(".sh")||t.endsWith(".py")||t.endsWith(".md")||t.match(/\.(png|jpe?g|gif|svg|bmp|webp)$/)}function _(e){const t=String(e||"").toLowerCase();return/\.(png|jpe?g|gif|svg|bmp|webp)$/.test(t)}function J(e,t){const n=e.endsWith("/")?e:e+"/",o=t.endsWith("/")?t:t+"/";return n===o}const y={path:document.getElementById("current-path"),status:document.getElementById("status"),tbody:document.getElementById("file-tbody"),refreshBtn:document.getElementById("refresh-btn"),fileInput:document.getElementById("file-input"),dropzone:document.getElementById("upload-zone")};function f(e,t="info"){if(!e){y.status.textContent="";return}const n=t==="error"?"错误：":t==="success"?"完成：":"";y.status.textContent=n+e}function N(e){const t=a.basePath.split("/").filter(Boolean),n=[],o=document.createElement("a");o.href="/",o.textContent="/",o.onclick=r=>{r.preventDefault(),e("/")},n.push(o.outerHTML);let s="";for(let r=0;r<t.length;r++){s+="/"+t[r];const d=decodeURIComponent(t[r]),l=s+"/",i=document.createElement("span");i.className="muted",i.textContent="/";const c=document.createElement("a");c.href=l,c.textContent=B(d);const m=l;c.onclick=u=>{u.preventDefault(),e(m)},n.push(i.outerHTML+" "+c.outerHTML)}y.path.innerHTML=n.join(" ")}function G(e){if(!a.items.length){y.tbody.innerHTML='<tr><td colspan="4" class="muted">空目录</td></tr>';return}const t=a.items.map(n=>{const o=n.href,s=n.isDir?`<span class="tag">目录</span><a href="${o}" class="dir-link">${B(n.name)}/</a>`:`<span class="tag">文件</span><a href="${o}" download>${B(n.name)}</a>`,r=n.isDir?"-":n.size!=null?j(n.size):n.sizeRaw||"-",d=n.mtime?F(n.mtime):n.mtimeRaw||"-",l=[];n.isDir?l.push(`<button class="btn action-enter" data-href="${o}">打开</button>`):(V(n.name)&&l.push(`<button class="btn action-view" data-href="${o}" data-name="${B(n.name)}">查看</button>`),l.push(`<a class="btn" href="${o}" download>下载</a>`)),a.supportsMove&&l.push(`<button class="btn action-rename" data-href="${o}">重命名</button>`),a.supportsDelete&&l.push(`<button class="btn danger action-delete" data-href="${o}">删除</button>`);const i=l.join(" ");return`<tr>
      <td>
        <div class="name">${s}</div>
        <div class="mobile-only">
          <div><span>${r}</span><span style="margin:0 6px;">•</span><span>${d}</span></div>
          <div class="mobile-actions">${i}</div>
        </div>
      </td>
      <td class="nowrap desktop-only">${r}</td>
      <td class="nowrap desktop-only">${d}</td>
      <td class="desktop-only"><div class="actions">${i}</div></td>
    </tr>`}).join("");y.tbody.innerHTML=t,y.tbody.querySelectorAll(".dir-link").forEach(n=>{n.onclick=o=>{o.preventDefault(),e.onNavigate(n.getAttribute("href"))}}),y.tbody.querySelectorAll(".action-enter").forEach(n=>{n.onclick=()=>e.onNavigate(n.getAttribute("data-href"))}),y.tbody.querySelectorAll(".action-view").forEach(n=>{n.onclick=()=>e.onView(n.getAttribute("data-href"),n.getAttribute("data-name"))}),y.tbody.querySelectorAll(".action-rename").forEach(n=>{n.onclick=()=>e.onRename(n.getAttribute("data-href"))}),y.tbody.querySelectorAll(".action-delete").forEach(n=>{n.onclick=()=>e.onDelete(n.getAttribute("data-href"))})}async function K(e){const t=e+(e.includes("?")?"&":"?")+"__list=1",n=await fetch(t,{method:"GET",credentials:"include"});if(!n.ok)throw new Error("JSON 列表失败，HTTP "+n.status);const o=await n.json();return(Array.isArray(o.items)?o.items:[]).map(r=>({name:String(r.name||"").replace(/\/$/,""),isDir:!!r.isDir,size:r.size==null?null:Number(r.size),mtime:r.mtime?new Date(r.mtime*1e3).toUTCString():null,href:I(e,String(r.name||""))}))}async function Y(e,t){const o=await fetch(e,{method:"PROPFIND",headers:{Depth:"1","Content-Type":"text/xml; charset=utf-8"},body:`<?xml version="1.0" encoding="utf-8"?>
<d:propfind xmlns:d="DAV:">
  <d:prop>
    <d:displayname/>
    <d:getcontentlength/>
    <d:getlastmodified/>
    <d:resourcetype/>
  </d:prop>
</d:propfind>`,credentials:"include"});if(!o.ok)throw new Error("PROPFIND 失败，HTTP "+o.status);const s=await o.text(),d=new DOMParser().parseFromString(s,"application/xml"),l=Array.from(d.getElementsByTagNameNS("*","response")),i=[];for(const c of l){const m=c.getElementsByTagNameNS("*","href")[0];if(!m)continue;const u=A(m.textContent||"",t);if(!u||J(u,e))continue;const p=c.getElementsByTagNameNS("*","propstat")[0],h=p?p.getElementsByTagNameNS("*","prop")[0]:null,T=h&&h.getElementsByTagNameNS("*","displayname")[0]?.textContent||"",P=h&&h.getElementsByTagNameNS("*","getcontentlength")[0]?.textContent||"",x=h&&h.getElementsByTagNameNS("*","getlastmodified")[0]?.textContent||"",v=h?h.getElementsByTagNameNS("*","resourcetype")[0]:null,C=!!(v&&v.getElementsByTagNameNS("*","collection")[0]),q=decodeURIComponent(T||u.split("/").filter(Boolean).pop()||"");i.push({name:q,isDir:C||u.endsWith("/"),size:C?null:P?Number(P):null,mtime:x||null,href:u})}return i.sort((c,m)=>c.isDir===m.isDir?c.name.localeCompare(m.name):c.isDir?-1:1)}async function X(e){const t=await fetch(e,{method:"GET",credentials:"include"});if(!t.ok)throw new Error("目录获取失败，HTTP "+t.status);if(!(t.headers.get("Content-Type")||"").includes("text/html"))throw new Error("非 HTML 索引，无法解析");const o=await t.text(),s=new DOMParser().parseFromString(o,"text/html"),r=[],d=s.querySelector("table");if(d){const i=Array.from(d.querySelectorAll("tr"));for(let c=1;c<i.length;c++){const m=i[c].children;if(m.length<2)continue;const u=m[0].querySelector("a");if(!u)continue;const p=u.getAttribute("href")||"",h=(u.textContent||"").trim();if(!p||h===".."||p==="../")continue;const T=A(p.startsWith("http")?p:new URL(p,e).href,window.location.origin);if(!T.startsWith(e))continue;const P=decodeURIComponent(T.split("/").filter(Boolean).pop()||""),x=m[1]?.textContent?.trim()||null,v=m[2]?.textContent?.trim()||null,C=p.endsWith("/")||h.endsWith("/");r.push({name:P,isDir:C,size:null,sizeRaw:v&&v!=="-"?v:null,mtime:null,mtimeRaw:x&&x!=="-"?x:null,href:T})}}else{const i=Array.from(s.querySelectorAll("a"));for(const c of i){const m=(c.textContent||"").trim(),u=c.getAttribute("href")||"";if(!u||m===".."||u==="../")continue;const p=A(u.startsWith("http")?u:new URL(u,e).href,window.location.origin);if(!p.startsWith(e))continue;const h=decodeURIComponent(p.split("/").filter(Boolean).pop()||"");r.push({name:h,isDir:p.endsWith("/"),size:null,sizeRaw:null,mtime:null,mtimeRaw:null,href:p})}}const l=new Map(r.map(i=>[i.href,i]));return Array.from(l.values()).sort((i,c)=>i.isDir===c.isDir?i.name.localeCompare(c.name):i.isDir?-1:1)}async function Q(e){try{const n=((await fetch(e,{method:"OPTIONS",credentials:"include"})).headers.get("Allow")||"").toUpperCase();return{supportsPut:n.includes("PUT"),supportsMove:n.includes("MOVE"),supportsDelete:n.includes("DELETE")}}catch{return{supportsPut:!1,supportsMove:!1,supportsDelete:!1}}}const H=document.getElementById("viewer-overlay"),b=document.getElementById("viewer-pre"),w=document.getElementById("viewer-html"),R=document.getElementById("viewer-img-wrap"),Z=document.getElementById("viewer-img"),ee=document.getElementById("viewer-title"),z=document.getElementById("viewer-hint"),te=document.getElementById("viewer-open-raw"),$=document.getElementById("viewer-toggle"),ne=document.getElementById("viewer-close");ne.onclick=()=>H.classList.add("hidden");window.addEventListener("keydown",e=>{e.key==="Escape"&&H.classList.add("hidden")});const L=512*1024;async function oe(e,t){ee.textContent=t,te.setAttribute("href",e),b.textContent="加载中...",w.style.display="none",R.style.display="none",b.style.display="block",$.classList.add("hidden"),z.textContent="",H.classList.remove("hidden");try{let n=null;try{const d=await fetch(e,{method:"HEAD",credentials:"include"});if(d.ok){const l=d.headers.get("Content-Length");l&&(n=Number(l))}}catch{}let o,s=!1;if(n!=null&&n>L?(o=await fetch(e,{method:"GET",headers:{Range:`bytes=0-${L-1}`},credentials:"include"}),s=!0):o=await fetch(e,{method:"GET",credentials:"include"}),!o.ok)throw new Error(`HTTP ${o.status}`);if(_(t)){Z.src=e,R.style.display="block",b.style.display="none";return}const r=await o.text();if(b.textContent=r,t.toLowerCase().endsWith(".md")){await se(2e3);const d=!!(window.marked&&window.DOMPurify);try{const l=d?ae(r):k(r);w.innerHTML=l,ie(w,e)}catch{w.innerHTML=k(r)}if(w.style.display="block",b.style.display="none",$.textContent="源码",$.classList.remove("hidden"),$.onclick=()=>{w.style.display!=="none"?(w.style.display="none",b.style.display="block",$.textContent="渲染"):(w.style.display="block",b.style.display="none",$.textContent="源码")},window.MathJax&&window.MathJax.typesetPromise)try{await window.MathJax.typesetPromise([w])}catch{}}s&&(z.textContent=`仅预览前 ${Math.round(L/1024)}KB，点击“下载”查看完整内容。`)}catch(n){b.textContent=`加载失败：${n&&n.message?n.message:String(n)}`}}let D=null;function re(){return D||(D=new Promise(async e=>{try{const t=[];window.marked||t.push(S("https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js")),window.DOMPurify||t.push(S("https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js")),window.MathJax||(window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},t.push(S("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"))),await Promise.all(t)}catch{}e()}),D)}function se(e){return Promise.race([re(),new Promise(t=>setTimeout(t,e))])}function S(e){return new Promise((t,n)=>{const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>t(),o.onerror=()=>n(new Error("load failed: "+e)),document.head.appendChild(o)})}function ae(e){try{const t={gfm:!0,breaks:!0,mangle:!1,headerIds:!0},n=window.marked.parse(e,t);return window.DOMPurify.sanitize(n,{USE_PROFILES:{html:!0}})}catch{return k(e)}}function ie(e,t){const n=new URL(t,window.location.origin);e.querySelectorAll("a[href]").forEach(o=>{const s=o.getAttribute("href")||"";if(!(/^(?:[a-z]+:)?\/\//i.test(s)||s.startsWith("#")||s.startsWith("/")))try{o.href=new URL(s,n).href}catch{}}),e.querySelectorAll("img[src]").forEach(o=>{const s=o.getAttribute("src")||"";if(!(/^(?:[a-z]+:)?\/\//i.test(s)||s.startsWith("/")))try{o.src=new URL(s,n).href}catch{}})}function k(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t=t.replace(/```([\s\S]*?)```/g,(o,s)=>`<pre><code>${s.replace(/\n$/,"")}</code></pre>`),t=t.replace(/^######\s+(.*)$/gm,"<h6>$1</h6>").replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>").replace(/^####\s+(.*)$/gm,"<h4>$1</h4>").replace(/^###\s+(.*)$/gm,"<h3>$1</h3>").replace(/^##\s+(.*)$/gm,"<h2>$1</h2>").replace(/^#\s+(.*)$/gm,"<h1>$1</h1>"),t=t.replace(/^(\s*)([-*])\s+(.*)$/gm,"$1<li>$3</li>"),t=t.replace(/(?:^(?:<li>.*<\/li>)(?:\n|$))+?/gm,o=>`<ul>${o.replace(/\n/g,"")}</ul>`),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),t.split(/\n\n+/).map(o=>/^<h\d|^<pre|^<ul|^<li|^<blockquote/.test(o)?o:`<p>${o.replace(/\n/g,"<br/>")}</p>`).join(`
`)}const g={refreshBtn:document.getElementById("refresh-btn"),fileInput:document.getElementById("file-input"),dropzone:document.getElementById("upload-zone"),tbody:document.getElementById("file-tbody")};async function E(){f("正在加载列表..."),g.tbody.innerHTML='<tr><td colspan="4" class="muted">加载中...</td></tr>';try{let e=[];try{e=await K(a.basePath),a.webdavCapable=!1}catch{try{e=await Y(a.basePath,a.origin),a.webdavCapable=!0}catch{a.webdavCapable=!1,e=await X(a.basePath)}}a.items=e;const t=await Q(a.basePath);a.supportsPut=t.supportsPut,a.supportsMove=t.supportsMove,a.supportsDelete=t.supportsDelete,a.webdavCapable||await ce(a.items),G({onNavigate:M,onView:oe,onRename:le,onDelete:ue}),f(`已加载 ${e.length} 项`)}catch(e){console.error(e),f(String(e&&e.message||e),"error"),g.tbody.innerHTML='<tr><td colspan="4" class="muted">加载失败</td></tr>'}}async function ce(e){const t=e.filter(n=>!n.isDir);await Promise.all(t.map(async n=>{try{const o=await fetch(n.href,{method:"HEAD",credentials:"include"});if(!o.ok)return;const s=o.headers.get("Content-Length"),r=o.headers.get("Last-Modified");s&&(n.size=Number(s)),r&&(n.mtime=r)}catch{}}))}function M(e){const t=new URL(e,a.origin),n=t.pathname.endsWith("/")?t.pathname:t.pathname+"/";a.currentPathname=n,a.basePath=n,history.pushState({path:n},"",n),N(M),E()}async function U(e){if(!(!e||!e.length)){if(!a.supportsPut){f("服务端不支持上传（PUT）","error");return}for(const t of e){const n=I(a.basePath,t.name);f(`上传中：${t.name}`);try{const o=await fetch(O(n),{method:"PUT",headers:{"Content-Type":t.type||"application/octet-stream",Overwrite:"T"},body:t,credentials:"include"});if(!o.ok)throw new Error(`HTTP ${o.status}`);f(`上传完成：${t.name}`,"success")}catch(o){console.error(o),f(`上传失败：${t.name}（${o.message}）`,"error")}}await E()}}function le(e){const t=decodeURIComponent(e.split("/").filter(Boolean).pop()||""),n=Array.from(g.tbody.querySelectorAll("button[data-href]")).find(i=>i.getAttribute("data-href")===e)?.closest("tr");if(!n)return;const o=n.children[0],s=e.endsWith("/"),r=document.createElement("div");r.className="inline-form",r.innerHTML=`
        <input type="text" value="${B(t)}" aria-label="新名称" style="flex:1" />
        <button class="btn ok-btn">确定</button>
        <button class="btn cancel-btn">取消</button>
    `;const d=o.innerHTML;o.innerHTML="",o.appendChild(r);const l=r.querySelector("input");r.querySelector(".cancel-btn").onclick=()=>{o.innerHTML=d},r.querySelector(".ok-btn").onclick=async()=>{const i=l.value.trim();if(!i||i===t){o.innerHTML=d;return}try{await de(e,i,s),f("重命名成功","success"),await E()}catch(c){console.error(c),f("重命名失败："+c.message,"error"),o.innerHTML=d}},l.focus(),l.select()}async function de(e,t,n){const o=I(a.basePath,t)+(n&&!t.endsWith("/")?"/":""),s=await fetch(e,{method:"MOVE",headers:{Destination:a.origin+O(o),Overwrite:"T"},credentials:"include"});if(!s.ok)throw new Error("HTTP "+s.status)}async function ue(e){const t=decodeURIComponent(e.split("/").filter(Boolean).pop()||e);if(confirm(`确认删除：${t} ？`))try{f("删除中...");const n=await fetch(e,{method:"DELETE",credentials:"include"});if(!n.ok)throw new Error("HTTP "+n.status);f("删除成功","success"),await E()}catch(n){console.error(n),f("删除失败："+n.message,"error")}}g.refreshBtn.onclick=E;g.fileInput.onchange=e=>U(e.target.files);g.dropzone.ondragover=e=>{e.preventDefault(),g.dropzone.classList.add("dragover")};g.dropzone.ondragleave=()=>g.dropzone.classList.remove("dragover");g.dropzone.ondrop=e=>{e.preventDefault(),g.dropzone.classList.remove("dragover"),U(e.dataTransfer?.files)};window.onpopstate=()=>{const e=W(location.pathname);a.currentPathname=e,a.basePath=e,N(M),E()};N(M);E();</script>
  <style rel="stylesheet" crossorigin>:root{--bg: #0b1020;--muted: #151b2f;--text: #e6edf3;--sub: #9fb0c3;--accent: #4aa3ff;--danger: #ff6b6b;--ok: #37d399;--warn: #fbbf24}html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji"}a{color:var(--accent);text-decoration:none}a:hover{text-decoration:underline}.container{max-width:1100px;margin:0 auto;padding:24px}header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px}header h1{font-size:18px;margin:0;font-weight:600}.path{color:var(--sub);word-break:break-all}.toolbar{display:flex;gap:8px;flex-wrap:wrap}button,.btn{background:var(--muted);color:var(--text);border:1px solid #25304a;border-radius:8px;padding:8px 12px;cursor:pointer}button:hover,.btn:hover{background:#1a2340}button.danger{border-color:#5c2b2b;color:#ffd4d4}button.danger:hover{background:#2a1717}.status{margin:12px 0;min-height:22px;color:var(--sub)}.panel{background:var(--muted);border:1px solid #25304a;border-radius:12px;overflow:hidden}.table{width:100%;border-collapse:collapse}.table thead th{text-align:left;padding:12px;background:#0f1527;color:var(--sub);font-weight:600;border-bottom:1px solid #25304a}.table tbody td{padding:12px;border-bottom:1px solid #25304a;vertical-align:middle}.name{display:flex;align-items:center;gap:8px}.tag{font-size:12px;color:#8fb3ff;background:#0b2a55;border:1px solid #1e3a75;padding:1px 6px;border-radius:999px}.actions{display:flex;gap:6px;flex-wrap:wrap}.nowrap{white-space:nowrap}.muted{color:var(--sub)}.dropzone{margin-top:16px;padding:18px;border:1px dashed #39507e;border-radius:12px;color:#b8c7da;text-align:center}.dropzone.dragover{background:#0f1527}input[type=text]{background:#0b1020;color:var(--text);border:1px solid #25304a;border-radius:6px;padding:6px 8px}input[type=file]{color:var(--text)}.inline-form{display:flex;gap:8px;align-items:center}.hint{color:#8aa0b9;font-size:12px}.hidden,.mobile-only{display:none}.md-body{color:var(--text)}.md-body h1,.md-body h2,.md-body h3,.md-body h4,.md-body h5,.md-body h6{margin:16px 0 8px}.md-body p{margin:10px 0}.md-body pre{background:#0b1020;border:1px solid #25304a;border-radius:8px;padding:12px;overflow:auto}.md-body code{background:#0f1527;border:1px solid #25304a;border-radius:6px;padding:1px 4px}.md-body pre code{background:transparent;border:none;padding:0}.md-body ul,.md-body ol{padding-left:22px}.md-body blockquote{border-left:3px solid #39507e;margin:8px 0;padding:4px 10px;color:#c9d6e2;background:#0f1527}.md-body table{width:100%;border-collapse:collapse;margin:10px 0}.md-body th,.md-body td{border:1px solid #25304a;padding:6px 10px;text-align:left}.md-body a{color:var(--accent)}#viewer-img-wrap{display:none;width:100%;height:100%;background:#0b1020;position:relative}#viewer-img-wrap img{position:absolute;inset:0;margin:auto;max-width:100%;max-height:100%;object-fit:contain}@media(max-width:640px){.container{padding:14px}header h1{font-size:16px}.toolbar{gap:6px}button,.btn{padding:9px 12px}.name a{font-size:16px}.tag{font-size:11px}.table thead{display:none}.desktop-only{display:none!important}.mobile-only{display:block!important;color:#9fb0c3;margin-top:4px;font-size:12px}.actions{gap:8px}.mobile-actions{display:flex;margin-top:8px;flex-wrap:wrap}}#viewer-overlay{display:flex}#viewer-overlay.hidden{display:none}</style>
</head>

<body>
    <div class="container">
        <header>
            <h1>文件管理器</h1>
            <div class="path" id="current-path"></div>
        </header>

        <div class="toolbar">
            <button id="refresh-btn">刷新</button>
            <label class="btn" for="file-input">选择文件上传</label>
            <input id="file-input" type="file" multiple class="hidden" />
        </div>
        <div class="status" id="status"></div>

        <div class="panel">
            <table class="table" id="file-table">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th class="nowrap">大小</th>
                        <th class="nowrap">修改时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="file-tbody">
                    <tr>
                        <td colspan="4" class="muted">加载中...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="viewer-overlay" class="hidden"
            style="position:fixed; inset:0; background:rgba(0,0,0,0.55); align-items:center; justify-content:center; z-index:9999;">
            <div
                style="background:var(--muted); border:1px solid #25304a; border-radius:12px; width:min(1000px, 92vw); height:min(80vh, 800px); display:flex; flex-direction:column; overflow:hidden;">
                <div
                    style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0f1527; border-bottom:1px solid #25304a;">
                    <div id="viewer-title" class="muted"
                        style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"></div>
                    <div style="display:flex; gap:8px;">
                        <button id="viewer-toggle" class="btn hidden">源码</button>
                        <a id="viewer-open-raw" class="btn" target="_blank" rel="noopener" download>下载</a>
                        <button id="viewer-close" class="btn">关闭</button>
                    </div>
                </div>
                <div style="flex:1; overflow:auto; position:relative;">
                    <div id="viewer-img-wrap"><img id="viewer-img" alt="preview" /></div>
                    <div id="viewer-html" class="md-body"
                        style="display:none; padding:14px; background:#0b1020; color:#e6edf3; line-height:1.6;"></div>
                    <pre id="viewer-pre"
                        style="margin:0; padding:14px; background:#0b1020; color:#e6edf3; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; line-height:1.4; white-space:pre;">
                    </pre>
                </div>
                <div id="viewer-hint" class="hint" style="padding:8px 12px; border-top:1px solid #25304a;"></div>
            </div>
        </div>

        <div id="upload-zone" class="dropzone">
            拖拽文件到此处上传，或点击上方“选择文件上传”<br />
            <span class="hint">上传会使用 HTTP PUT 到当前目录；如需重名覆盖请确认服务端允许</span>
        </div>

        <p class="hint">说明：页面优先使用 WebDAV 方法（PROPFIND/PUT/MOVE/DELETE）。若服务端未启用 WebDAV，将尝试解析目录索引 HTML
            获取列表；但重命名/删除需服务端支持相应方法。</p>
    </div>
</body>

</html>