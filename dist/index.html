<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>文件管理器</title>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function _(t){return t.endsWith("/")?t:t.slice(0,t.lastIndexOf("/")+1)}const c={currentPathname:window.location.pathname,basePath:_(window.location.pathname),origin:window.location.origin,items:[],webdavCapable:!0,supportsPut:!1,supportsMove:!1,supportsDelete:!1};function v(t){return String(t).replace(/[&<>"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[e])}function X(t){if(t==null||isNaN(t))return"-";const e=["B","KB","MB","GB","TB"];let n=0,s=Number(t);for(;s>=1024&&n<e.length-1;)s/=1024,n++;return s.toFixed(s<10&&n>0?2:0)+" "+e[n]}function Q(t){if(!t)return"-";const e=new Date(t);if(String(e)==="Invalid Date")return"-";const n=s=>String(s).padStart(2,"0");return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}`}function U(t,e){return t.endsWith("/")||(t+="/"),t+e}function G(t){return t.split("/").map(e=>encodeURIComponent(e)).join("/").replace(/%2F/gi,"/")}function W(t,e){try{return new URL(t,e).pathname}catch{return t}}function Z(t){const e=String(t||"").toLowerCase();return!!([".txt",".log",".sh",".py",".md",".html",".htm",".css",".js",".json",".jsx",".ts",".tsx",".go",".c",".cpp",".h",".php",".sql",".yaml",".yml",".xml",".rs",".java",".kt",".swift",".rb",".lua",".pl"].some(s=>e.endsWith(s))||/\.(png|jpe?g|gif|svg|bmp|webp)$/.test(e)||/\.(mp4|webm|ogg|mov)$/.test(e))}function ee(t){const e=String(t||"").toLowerCase();return/\.(png|jpe?g|gif|svg|bmp|webp)$/.test(e)}function te(t){const e=String(t||"").toLowerCase();return/\.(mp4|webm|ogg|mov)$/.test(e)}function ne(t,e){const n=t.endsWith("/")?t:t+"/",s=e.endsWith("/")?e:e+"/";return n===s}function se(t){const e=String(t||"").toLowerCase();return e.match(/\.(png|jpe?g|gif|svg|bmp|webp)$/)?"图片":e.match(/\.(mp4|webm|ogg|mov|avi|mkv|flv)$/)?"视频":e.match(/\.(mp3|wav|flac|aac|m4a|ogg)$/)?"音频":e.match(/\.(html|htm|css|js|json|jsx|ts|tsx|py|sh|go|c|cpp|h|php|sql|yaml|yml|xml)$/)?"代码":e.match(/\.(md|markdown|txt|log|pdf|doc|docx|xls|xlsx|ppt|pptx|rtf|epub)$/)?"文档":e.match(/\.(zip|rar|7z|tar|gz|bz2|xz)$/)?"压缩包":e.match(/\.(exe|msi|deb|rpm|dmg|apk)$/)?"程序":"文件"}const w={path:document.getElementById("current-path"),status:document.getElementById("status"),tbody:document.getElementById("file-tbody"),refreshBtn:document.getElementById("refresh-btn"),fileInput:document.getElementById("file-input"),dropzone:document.getElementById("upload-zone")};function g(t,e="info"){if(!t){w.status.textContent="";return}const n=e==="error"?"错误：":e==="success"?"完成：":"";w.status.textContent=n+t}function F(t){const e=c.basePath.split("/").filter(Boolean),n=[],s=document.createElement("a");s.href="/",s.textContent="/",s.onclick=r=>{r.preventDefault(),t("/")},n.push(s.outerHTML);let o="";for(let r=0;r<e.length;r++){o+="/"+e[r];const i=decodeURIComponent(e[r]),d=o+"/",l=document.createElement("span");l.className="muted",l.textContent="/";const a=document.createElement("a");a.href=d,a.textContent=v(i);const u=d;a.onclick=m=>{m.preventDefault(),t(u)},n.push(l.outerHTML+" "+a.outerHTML)}w.path.innerHTML=n.join(" ")}function oe(t){if(!c.items.length){w.tbody.innerHTML='<tr><td colspan="4" class="muted">空目录</td></tr>';return}const e=c.items.map(n=>{const s=n.href,o=n.isDir?"目录":se(n.name),r=n.isDir?`<span class="tag">${o}</span><a href="${s}" class="dir-link">${v(n.name)}/</a>`:`<span class="tag">${o}</span><a href="${s}" download>${v(n.name)}</a>`,i=n.isDir?"-":n.size!=null?X(n.size):n.sizeRaw||"-",d=n.mtime?Q(n.mtime):n.mtimeRaw||"-",l=[];n.isDir?l.push(`<button class="btn action-enter" data-href="${s}">打开</button>`):(Z(n.name)&&l.push(`<button class="btn action-view" data-href="${s}" data-name="${v(n.name)}">查看</button>`),l.push(`<a class="btn" href="${s}" download>下载</a>`)),c.supportsMove&&l.push(`<button class="btn action-rename" data-href="${s}">重命名</button>`),c.supportsDelete&&l.push(`<button class="btn danger action-delete" data-href="${s}">删除</button>`);const a=l.join(" ");return`<tr>
      <td>
        <div class="name">${r}</div>
        <div class="mobile-only">
          <div><span>${i}</span><span style="margin:0 6px;">•</span><span>${d}</span></div>
          <div class="mobile-actions">${a}</div>
        </div>
      </td>
      <td class="nowrap desktop-only">${i}</td>
      <td class="nowrap desktop-only">${d}</td>
      <td class="desktop-only"><div class="actions">${a}</div></td>
    </tr>`}).join("");w.tbody.innerHTML=e,w.tbody.querySelectorAll(".dir-link").forEach(n=>{n.onclick=s=>{s.preventDefault(),t.onNavigate(n.getAttribute("href"))}}),w.tbody.querySelectorAll(".action-enter").forEach(n=>{n.onclick=()=>t.onNavigate(n.getAttribute("data-href"))}),w.tbody.querySelectorAll(".action-view").forEach(n=>{n.onclick=()=>t.onView(n.getAttribute("data-href"),n.getAttribute("data-name"))}),w.tbody.querySelectorAll(".action-rename").forEach(n=>{n.onclick=()=>t.onRename(n.getAttribute("data-href"))}),w.tbody.querySelectorAll(".action-delete").forEach(n=>{n.onclick=()=>t.onDelete(n.getAttribute("data-href"))})}async function re(t){const e=t+(t.includes("?")?"&":"?")+"__list=1",n=await fetch(e,{method:"GET",credentials:"include"});if(!n.ok)throw new Error("JSON 列表失败，HTTP "+n.status);const s=await n.json();return(Array.isArray(s.items)?s.items:[]).map(r=>({name:String(r.name||"").replace(/\/$/,""),isDir:!!r.isDir,size:r.size==null?null:Number(r.size),mtime:r.mtime?new Date(r.mtime*1e3).toUTCString():null,href:U(t,String(r.name||""))}))}async function ie(t,e){const s=await fetch(t,{method:"PROPFIND",headers:{Depth:"1","Content-Type":"text/xml; charset=utf-8"},body:`<?xml version="1.0" encoding="utf-8"?>
<d:propfind xmlns:d="DAV:">
  <d:prop>
    <d:displayname/>
    <d:getcontentlength/>
    <d:getlastmodified/>
    <d:resourcetype/>
  </d:prop>
</d:propfind>`,credentials:"include"});if(!s.ok)throw new Error("PROPFIND 失败，HTTP "+s.status);const o=await s.text(),i=new DOMParser().parseFromString(o,"application/xml"),d=Array.from(i.getElementsByTagNameNS("*","response")),l=[];for(const a of d){const u=a.getElementsByTagNameNS("*","href")[0];if(!u)continue;const m=W(u.textContent||"",e);if(!m||ne(m,t))continue;const p=a.getElementsByTagNameNS("*","propstat")[0],h=p?p.getElementsByTagNameNS("*","prop")[0]:null,T=h&&h.getElementsByTagNameNS("*","displayname")[0]?.textContent||"",S=h&&h.getElementsByTagNameNS("*","getcontentlength")[0]?.textContent||"",L=h&&h.getElementsByTagNameNS("*","getlastmodified")[0]?.textContent||"",E=h?h.getElementsByTagNameNS("*","resourcetype")[0]:null,D=!!(E&&E.getElementsByTagNameNS("*","collection")[0]),Y=decodeURIComponent(T||m.split("/").filter(Boolean).pop()||"");l.push({name:Y,isDir:D||m.endsWith("/"),size:D?null:S?Number(S):null,mtime:L||null,href:m})}return l.sort((a,u)=>a.isDir===u.isDir?a.name.localeCompare(u.name):a.isDir?-1:1)}async function ae(t){const e=await fetch(t,{method:"GET",credentials:"include"});if(!e.ok)throw new Error("目录获取失败，HTTP "+e.status);if(!(e.headers.get("Content-Type")||"").includes("text/html"))throw new Error("非 HTML 索引，无法解析");const s=await e.text(),o=new DOMParser().parseFromString(s,"text/html"),r=[],i=o.querySelector("table");if(i){const l=Array.from(i.querySelectorAll("tr"));for(let a=1;a<l.length;a++){const u=l[a].children;if(u.length<2)continue;const m=u[0].querySelector("a");if(!m)continue;const p=m.getAttribute("href")||"",h=(m.textContent||"").trim();if(!p||h===".."||p==="../")continue;const T=W(p.startsWith("http")?p:new URL(p,t).href,window.location.origin);if(!T.startsWith(t))continue;const S=decodeURIComponent(T.split("/").filter(Boolean).pop()||""),L=u[1]?.textContent?.trim()||null,E=u[2]?.textContent?.trim()||null,D=p.endsWith("/")||h.endsWith("/");r.push({name:S,isDir:D,size:null,sizeRaw:E&&E!=="-"?E:null,mtime:null,mtimeRaw:L&&L!=="-"?L:null,href:T})}}else{const l=Array.from(o.querySelectorAll("a"));for(const a of l){const u=(a.textContent||"").trim(),m=a.getAttribute("href")||"";if(!m||u===".."||m==="../")continue;const p=W(m.startsWith("http")?m:new URL(m,t).href,window.location.origin);if(!p.startsWith(t))continue;const h=decodeURIComponent(p.split("/").filter(Boolean).pop()||"");r.push({name:h,isDir:p.endsWith("/"),size:null,sizeRaw:null,mtime:null,mtimeRaw:null,href:p})}}const d=new Map(r.map(l=>[l.href,l]));return Array.from(d.values()).sort((l,a)=>l.isDir===a.isDir?l.name.localeCompare(a.name):l.isDir?-1:1)}async function le(t){try{const n=((await fetch(t,{method:"OPTIONS",credentials:"include"})).headers.get("Allow")||"").toUpperCase();return{supportsPut:n.includes("PUT"),supportsMove:n.includes("MOVE"),supportsDelete:n.includes("DELETE")}}catch{return{supportsPut:!1,supportsMove:!1,supportsDelete:!1}}}const V=document.getElementById("viewer-overlay"),f=document.getElementById("viewer-pre"),b=document.getElementById("viewer-html"),J=document.getElementById("viewer-img-wrap"),ce=document.getElementById("viewer-img"),C=document.getElementById("viewer-video"),de=document.getElementById("viewer-title"),R=document.getElementById("viewer-hint"),ue=document.getElementById("viewer-open-raw"),x=document.getElementById("viewer-toggle"),me=document.getElementById("viewer-close"),B=document.getElementById("viewer-word-wrap");me.onclick=()=>V.classList.add("hidden");window.addEventListener("keydown",t=>{t.key==="Escape"&&V.classList.add("hidden")});let M=!1,N="",q={},P=new Set;function pe(t,e=""){const n=t.split(`
`),s={};if(e.toLowerCase().endsWith(".py"))for(let r=0;r<n.length;r++){const i=n[r];if(!i.trimEnd().endsWith(":"))continue;const l=i.length-i.trimStart().length;let a=r;for(let u=r+1;u<n.length;u++){const m=n[u];if(m.trim().length===0){a=u;continue}if(m.length-m.trimStart().length<=l)break;a=u}a>r&&(s[r]=a)}else{const r=[];for(let i=0;i<n.length;i++){const d=n[i];for(let l of d)if(l==="{")r.push(i);else if(l==="}"){const a=r.pop();a!==void 0&&i>a&&(s[a]||(s[a]=i))}}}return s}B.onclick=()=>{M=!M,B.classList.toggle("active",M),f.classList.toggle("wrap",M)};function k(t=!1){f.style.padding="0";let e="";if(t&&window.hljs)try{e=window.hljs.highlightAuto(N).value}catch{e=v(N)}else e=v(N);const n=e.split(`
`);let s="";for(let o=0;o<n.length;o++){const r=q[o]!==void 0,i=P.has(o),d=["ln-row",i?"folded":""].join(" ").trim(),l=r?`<span class="ln-fold" data-line="${o}"></span>`:"",a=`<span class="ln-num" data-num="${o+1}">${l}</span>`;let u=n[o]||" ";i&&(u+=`<span class="folded-ellipsis" data-line="${o}">...</span>`),s+=`<div class="${d}">${a}<span class="ln-content">${u}</span></div>`,i&&(o=q[o])}f.innerHTML=s,f.querySelectorAll("[data-line]").forEach(o=>{o.onclick=r=>{r.stopPropagation();const i=parseInt(o.dataset.line);P.has(i)?P.delete(i):P.add(i),k(t)}})}const z=512*1024;async function he(t,e){de.textContent=e,ue.setAttribute("href",t),f.textContent="加载中...",b.style.display="none",J.style.display="none",C.style.display="none",C.pause(),C.src="",f.style.display="block",x.classList.add("hidden"),R.textContent="",V.classList.remove("hidden");try{let n=null;try{const i=await fetch(t,{method:"HEAD",credentials:"include"});if(i.ok){const d=i.headers.get("Content-Length");d&&(n=Number(d))}}catch{}let s,o=!1;if(n!=null&&n>z?(s=await fetch(t,{method:"GET",headers:{Range:`bytes=0-${z-1}`},credentials:"include"}),o=!0):s=await fetch(t,{method:"GET",credentials:"include"}),!s.ok)throw new Error(`HTTP ${s.status}`);if(ee(e)){ce.src=t,J.style.display="block",f.style.display="none",B.classList.add("hidden");return}if(te(e)){C.src=t,C.style.display="block",f.style.display="none",B.classList.add("hidden"),R.textContent="提示：视频加载可能需要一些时间";return}B.classList.remove("hidden");const r=await s.text();if(N=r,P.clear(),q=pe(r,e),e.toLowerCase().endsWith(".md")){k(),await we(2e3);const i=!!(window.marked&&window.DOMPurify);try{const d=i?be(r):O(r);b.innerHTML=d,ve(b,t)}catch{b.innerHTML=O(r)}if(b.style.display="block",f.style.display="none",x.textContent="源码",x.classList.remove("hidden"),x.onclick=()=>{b.style.display!=="none"?(b.style.display="none",f.style.display="block",x.textContent="渲染",k()):(b.style.display="block",f.style.display="none",x.textContent="源码")},window.MathJax&&window.MathJax.typesetPromise)try{await window.MathJax.typesetPromise([b])}catch{}}else!e.toLowerCase().endsWith(".txt")&&!e.toLowerCase().endsWith(".log")?(await ge(2e3),k(!0)):k(!1);o&&(R.textContent=`仅预览前 ${Math.round(z/1024)}KB，点击“下载”查看完整内容。`)}catch(n){f.textContent=`加载失败：${n&&n.message?n.message:String(n)}`}}let I=null;function fe(){return I||(I=new Promise(async t=>{try{const e=[];if(window.hljs||e.push(H("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js")),!document.querySelector('link[href*="highlight.js"]')){const n=document.createElement("link");n.rel="stylesheet",n.href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css",document.head.appendChild(n)}await Promise.all(e)}catch{}t()}),I)}function ge(t){return Promise.race([fe(),new Promise(e=>setTimeout(e,t))])}let A=null;function ye(){return A||(A=new Promise(async t=>{try{const e=[];window.marked||e.push(H("https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js")),window.DOMPurify||e.push(H("https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js")),window.MathJax||(window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:"global"}},e.push(H("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"))),await Promise.all(e)}catch{}t()}),A)}function we(t){return Promise.race([ye(),new Promise(e=>setTimeout(e,t))])}function H(t){return new Promise((e,n)=>{const s=document.createElement("script");s.src=t,s.async=!0,s.onload=()=>e(),s.onerror=()=>n(new Error("load failed: "+t)),document.head.appendChild(s)})}function be(t){try{const e={gfm:!0,breaks:!0,mangle:!1,headerIds:!0},n=window.marked.parse(t,e);return window.DOMPurify.sanitize(n,{USE_PROFILES:{html:!0}})}catch{return O(t)}}function ve(t,e){const n=new URL(e,window.location.origin);t.querySelectorAll("a[href]").forEach(s=>{const o=s.getAttribute("href")||"";if(!(/^(?:[a-z]+:)?\/\//i.test(o)||o.startsWith("#")||o.startsWith("/")))try{s.href=new URL(o,n).href}catch{}}),t.querySelectorAll("img[src]").forEach(s=>{const o=s.getAttribute("src")||"";if(!(/^(?:[a-z]+:)?\/\//i.test(o)||o.startsWith("/")))try{s.src=new URL(o,n).href}catch{}})}function O(t){let e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e=e.replace(/```([\s\S]*?)```/g,(s,o)=>`<pre><code>${o.replace(/\n$/,"")}</code></pre>`),e=e.replace(/^######\s+(.*)$/gm,"<h6>$1</h6>").replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>").replace(/^####\s+(.*)$/gm,"<h4>$1</h4>").replace(/^###\s+(.*)$/gm,"<h3>$1</h3>").replace(/^##\s+(.*)$/gm,"<h2>$1</h2>").replace(/^#\s+(.*)$/gm,"<h1>$1</h1>"),e=e.replace(/^(\s*)([-*])\s+(.*)$/gm,"$1<li>$3</li>"),e=e.replace(/(?:^(?:<li>.*<\/li>)(?:\n|$))+?/gm,s=>`<ul>${s.replace(/\n/g,"")}</ul>`),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),e.split(/\n\n+/).map(s=>/^<h\d|^<pre|^<ul|^<li|^<blockquote/.test(s)?s:`<p>${s.replace(/\n/g,"<br/>")}</p>`).join(`
`)}const y={refreshBtn:document.getElementById("refresh-btn"),fileInput:document.getElementById("file-input"),dropzone:document.getElementById("upload-zone"),tbody:document.getElementById("file-tbody")};async function $(){g("正在加载列表..."),y.tbody.innerHTML='<tr><td colspan="4" class="muted">加载中...</td></tr>';try{let t=[];try{t=await re(c.basePath),c.webdavCapable=!1}catch{try{t=await ie(c.basePath,c.origin),c.webdavCapable=!0}catch{c.webdavCapable=!1,t=await ae(c.basePath)}}c.items=t;const e=await le(c.basePath);c.supportsPut=e.supportsPut,c.supportsMove=e.supportsMove,c.supportsDelete=e.supportsDelete,c.webdavCapable||await $e(c.items),oe({onNavigate:j,onView:he,onRename:Ee,onDelete:Te}),g(`已加载 ${t.length} 项`)}catch(t){console.error(t),g(String(t&&t.message||t),"error"),y.tbody.innerHTML='<tr><td colspan="4" class="muted">加载失败</td></tr>'}}async function $e(t){const e=t.filter(n=>!n.isDir);await Promise.all(e.map(async n=>{try{const s=await fetch(n.href,{method:"HEAD",credentials:"include"});if(!s.ok)return;const o=s.headers.get("Content-Length"),r=s.headers.get("Last-Modified");o&&(n.size=Number(o)),r&&(n.mtime=r)}catch{}}))}function j(t){const e=new URL(t,c.origin),n=e.pathname.endsWith("/")?e.pathname:e.pathname+"/";c.currentPathname=n,c.basePath=n,history.pushState({path:n},"",n),F(j),$()}async function K(t){if(!(!t||!t.length)){if(!c.supportsPut){g("服务端不支持上传（PUT）","error");return}for(const e of t){const n=U(c.basePath,e.name);g(`上传中：${e.name}`);try{const s=await fetch(G(n),{method:"PUT",headers:{"Content-Type":e.type||"application/octet-stream",Overwrite:"T"},body:e,credentials:"include"});if(!s.ok)throw new Error(`HTTP ${s.status}`);g(`上传完成：${e.name}`,"success")}catch(s){console.error(s),g(`上传失败：${e.name}（${s.message}）`,"error")}}await $()}}function Ee(t){const e=decodeURIComponent(t.split("/").filter(Boolean).pop()||""),n=Array.from(y.tbody.querySelectorAll("button[data-href]")).find(l=>l.getAttribute("data-href")===t)?.closest("tr");if(!n)return;const s=n.children[0],o=t.endsWith("/"),r=document.createElement("div");r.className="inline-form",r.innerHTML=`
        <input type="text" value="${v(e)}" aria-label="新名称" style="flex:1" />
        <button class="btn ok-btn">确定</button>
        <button class="btn cancel-btn">取消</button>
    `;const i=s.innerHTML;s.innerHTML="",s.appendChild(r);const d=r.querySelector("input");r.querySelector(".cancel-btn").onclick=()=>{s.innerHTML=i},r.querySelector(".ok-btn").onclick=async()=>{const l=d.value.trim();if(!l||l===e){s.innerHTML=i;return}try{await xe(t,l,o),g("重命名成功","success"),await $()}catch(a){console.error(a),g("重命名失败："+a.message,"error"),s.innerHTML=i}},d.focus(),d.select()}async function xe(t,e,n){const s=U(c.basePath,e)+(n&&!e.endsWith("/")?"/":""),o=await fetch(t,{method:"MOVE",headers:{Destination:c.origin+G(s),Overwrite:"T"},credentials:"include"});if(!o.ok)throw new Error("HTTP "+o.status)}async function Te(t){const e=decodeURIComponent(t.split("/").filter(Boolean).pop()||t);if(confirm(`确认删除：${e} ？`))try{g("删除中...");const n=await fetch(t,{method:"DELETE",credentials:"include"});if(!n.ok)throw new Error("HTTP "+n.status);g("删除成功","success"),await $()}catch(n){console.error(n),g("删除失败："+n.message,"error")}}y.refreshBtn.onclick=$;y.fileInput.onchange=t=>K(t.target.files);y.dropzone.ondragover=t=>{t.preventDefault(),y.dropzone.classList.add("dragover")};y.dropzone.ondragleave=()=>y.dropzone.classList.remove("dragover");y.dropzone.ondrop=t=>{t.preventDefault(),y.dropzone.classList.remove("dragover"),K(t.dataTransfer?.files)};window.onpopstate=()=>{const t=_(location.pathname);c.currentPathname=t,c.basePath=t,F(j),$()};F(j);$();</script>
  <style rel="stylesheet" crossorigin>:root{--bg: #0b1020;--muted: #151b2f;--text: #e6edf3;--sub: #9fb0c3;--accent: #4aa3ff;--danger: #ff6b6b;--ok: #37d399;--warn: #fbbf24}html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji"}a{color:var(--accent);text-decoration:none}a:hover{text-decoration:underline}.container{max-width:1100px;margin:0 auto;padding:24px}header{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px}header h1{font-size:18px;margin:0;font-weight:600}.path{color:var(--sub);word-break:break-all}.toolbar{display:flex;gap:8px;flex-wrap:wrap}button,.btn{background:var(--muted);color:var(--text);border:1px solid #25304a;border-radius:8px;padding:8px 12px;cursor:pointer}button:hover,.btn:hover{background:#1a2340}button.active,.btn.active{background:#1e3a75;border-color:var(--accent);color:var(--accent)}button.danger{border-color:#5c2b2b;color:#ffd4d4}button.danger:hover{background:#2a1717}.status{margin:12px 0;min-height:22px;color:var(--sub)}.panel{background:var(--muted);border:1px solid #25304a;border-radius:12px;overflow:hidden}.table{width:100%;border-collapse:collapse}.table thead th{text-align:left;padding:12px;background:#0f1527;color:var(--sub);font-weight:600;border-bottom:1px solid #25304a}.table tbody td{padding:12px;border-bottom:1px solid #25304a;vertical-align:middle}.name{display:flex;align-items:center;gap:8px}.tag{font-size:12px;color:#8fb3ff;background:#0b2a55;border:1px solid #1e3a75;padding:1px 6px;border-radius:999px}.actions{display:flex;gap:6px;flex-wrap:wrap}.nowrap{white-space:nowrap}.muted{color:var(--sub)}.dropzone{margin-top:16px;padding:18px;border:1px dashed #39507e;border-radius:12px;color:#b8c7da;text-align:center}.dropzone.dragover{background:#0f1527}input[type=text]{background:#0b1020;color:var(--text);border:1px solid #25304a;border-radius:6px;padding:6px 8px}input[type=file]{color:var(--text)}.inline-form{display:flex;gap:8px;align-items:center}.hint{color:#8aa0b9;font-size:12px}.hidden,.mobile-only{display:none}.md-body{color:var(--text)}.md-body h1,.md-body h2,.md-body h3,.md-body h4,.md-body h5,.md-body h6{margin:16px 0 8px}.md-body p{margin:10px 0}.md-body pre{background:#0b1020;border:1px solid #25304a;border-radius:8px;padding:12px;overflow:auto}.md-body code{background:#0f1527;border:1px solid #25304a;border-radius:6px;padding:1px 4px}.md-body pre code{background:transparent;border:none;padding:0}.md-body ul,.md-body ol{padding-left:22px}.md-body blockquote{border-left:3px solid #39507e;margin:8px 0;padding:4px 10px;color:#c9d6e2;background:#0f1527}.md-body table{width:100%;border-collapse:collapse;margin:10px 0}.md-body th,.md-body td{border:1px solid #25304a;padding:6px 10px;text-align:left}.md-body a{color:var(--accent)}#viewer-img-wrap{display:none;width:100%;height:100%;background:#0b1020;position:relative}#viewer-img-wrap img{position:absolute;inset:0;margin:auto;max-width:100%;max-height:100%;object-fit:contain}@media(max-width:640px){.container{padding:14px}header h1{font-size:16px}.toolbar{gap:6px}button,.btn{padding:9px 12px}.name a{font-size:16px}.tag{font-size:11px}.table thead{display:none}.desktop-only{display:none!important}.mobile-only{display:block!important;color:#9fb0c3;margin-top:4px;font-size:12px}.actions{gap:8px}.mobile-actions{display:flex;margin-top:8px;flex-wrap:wrap}}#viewer-overlay{display:flex}#viewer-overlay.hidden{display:none}.ln-row{display:flex;align-items:flex-start;line-height:1.6}.ln-num{width:3.5rem;flex-shrink:0;text-align:right;padding-right:12px;padding-top:2px;color:#4b5e7d;background:#090e1a;-webkit-user-select:none;user-select:none;border-right:1px solid #25304a;margin-right:12px;font-size:11px;position:relative}.ln-num:before{content:attr(data-num)}.ln-content{flex:1;white-space:pre;overflow-x:auto;padding-top:2px;padding-bottom:2px}#viewer-pre.wrap .ln-content{white-space:pre-wrap;word-break:break-all;overflow-x:hidden}.ln-row.no-num .ln-num{display:none}.ln-row.no-num .ln-content{padding-left:14px}.ln-fold{position:absolute;left:4px;top:0;width:20px;height:100%;cursor:pointer;color:#4b5e7d;font-size:9px;display:flex;align-items:center;justify-content:center;transition:transform .2s;-webkit-user-select:none;user-select:none;z-index:20}.ln-fold:before{content:"▶";display:inline-block;transform:rotate(90deg)}.ln-row.folded .ln-fold:before{transform:rotate(0)}.folded-ellipsis{background:#1a2340;color:#4aa3ff;padding:0 6px;border-radius:4px;font-size:11px;cursor:pointer;margin-left:8px;display:inline-block;line-height:1.2;font-weight:700}.folded-ellipsis:hover{background:#25304a}#viewer-overlay .md-body{-webkit-user-select:text;user-select:text}</style>
</head>

<body>
    <div class="container">
        <header>
            <h1>文件管理器</h1>
            <div class="path" id="current-path"></div>
        </header>

        <div class="toolbar">
            <button id="refresh-btn">刷新</button>
            <label class="btn" for="file-input">选择文件上传</label>
            <input id="file-input" type="file" multiple class="hidden" />
        </div>
        <div class="status" id="status"></div>

        <div class="panel">
            <table class="table" id="file-table">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th class="nowrap">大小</th>
                        <th class="nowrap">修改时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="file-tbody">
                    <tr>
                        <td colspan="4" class="muted">加载中...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="viewer-overlay" class="hidden"
            style="position:fixed; inset:0; background:rgba(0,0,0,0.55); align-items:center; justify-content:center; z-index:9999;">
            <div
                style="background:var(--muted); border:1px solid #25304a; border-radius:12px; width:min(1000px, 92vw); height:min(80vh, 800px); display:flex; flex-direction:column; overflow:hidden;">
                <div
                    style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0f1527; border-bottom:1px solid #25304a;">
                    <div id="viewer-title" class="muted"
                        style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"></div>
                    <div style="display:flex; gap:8px;">
                        <button id="viewer-toggle" class="btn hidden">源码</button>
                        <button id="viewer-word-wrap" class="btn" title="开启/关闭自动换行">换行</button>
                        <a id="viewer-open-raw" class="btn" target="_blank" rel="noopener" download>下载</a>
                        <button id="viewer-close" class="btn">关闭</button>
                    </div>
                </div>
                <div style="flex:1; overflow:auto; position:relative;">
                    <div id="viewer-img-wrap"><img id="viewer-img" alt="preview" /></div>
                    <video id="viewer-video" controls playsinline
                        style="display:none; width:100%; max-height:100%; background:#000;"></video>
                    <div id="viewer-html" class="md-body"
                        style="display:none; padding:14px; background:#0b1020; color:#e6edf3; line-height:1.6;"></div>
                    <pre id="viewer-pre"
                        style="margin:0; padding:0; background:#0b1020; color:#e6edf3; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13px; line-height: 1.6; white-space: pre;">
                    </pre>
                </div>
                <div id="viewer-hint" class="hint" style="padding:8px 12px; border-top:1px solid #25304a;"></div>
            </div>
        </div>

        <div id="upload-zone" class="dropzone">
            拖拽文件到此处上传，或点击上方“选择文件上传”<br />
            <span class="hint">上传会使用 HTTP PUT 到当前目录；如需重名覆盖请确认服务端允许</span>
        </div>

        <p class="hint">说明：页面优先使用 WebDAV 方法（PROPFIND/PUT/MOVE/DELETE）。若服务端未启用 WebDAV，将尝试解析目录索引 HTML
            获取列表；但重命名/删除需服务端支持相应方法。</p>
    </div>
</body>

</html>