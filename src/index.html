<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>文件管理器</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='2' y1='2' x2='22' y2='22' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0%25' stop-color='%234facfe'/%3E%3Cstop offset='100%25' stop-color='%2300f2fe'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='url(%23g)' d='M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6 10H6v-2h8v2zm4-4H6v-2h12v2z' opacity='.9'/%3E%3C/svg%3E">
</head>

<body>
    <div class="container">
        <header>
            <h1>文件管理器</h1>
            <div class="path" id="current-path"></div>
        </header>

        <div class="toolbar">
            <button id="refresh-btn">刷新</button>
            <label class="btn" for="file-input">选择文件上传</label>
            <input id="file-input" type="file" multiple class="hidden" />
        </div>
        <div class="status" id="status"></div>
        <div id="upload-progress-container" class="hidden" style="margin: 12px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 12px;">
                <span id="upload-filename" class="sub">文件名</span>
                <span id="upload-speed" class="sub">0 KB/s</span>
            </div>
            <div
                style="height: 8px; background: #0f1527; border-radius: 4px; overflow: hidden; border: 1px solid #25304a;">
                <div id="upload-progress-bar"
                    style="width: 0%; height: 100%; background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%); transition: width 0.3s;">
                </div>
            </div>
        </div>

        <div class="panel">
            <table class="table" id="file-table">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th class="nowrap">大小</th>
                        <th class="nowrap">修改时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="file-tbody">
                    <tr>
                        <td colspan="4" class="muted">加载中...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="viewer-overlay" class="hidden"
            style="position:fixed; inset:0; background:rgba(0,0,0,0.55); align-items:center; justify-content:center; z-index:9999;">
            <div
                style="background:var(--muted); border:1px solid #25304a; border-radius:12px; width:min(1000px, 92vw); height:min(80vh, 800px); display:flex; flex-direction:column; overflow:hidden;">
                <div
                    style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#0f1527; border-bottom:1px solid #25304a;">
                    <div id="viewer-title" class="muted"
                        style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"></div>
                    <div style="display:flex; gap:8px;">
                        <button id="viewer-toggle" class="btn hidden">源码</button>
                        <button id="viewer-word-wrap" class="btn" title="开启/关闭自动换行">换行</button>
                        <a id="viewer-open-raw" class="btn" target="_blank" rel="noopener" download>下载</a>
                        <button id="viewer-close" class="btn">关闭</button>
                    </div>
                </div>
                <div style="flex:1; overflow:auto; position:relative;">
                    <div id="viewer-img-wrap"><img id="viewer-img" alt="preview" /></div>
                    <video id="viewer-video" controls playsinline
                        style="display:none; width:100%; max-height:100%; background:#000;"></video>
                    <div id="viewer-html" class="md-body"
                        style="display:none; padding:14px; background:#0b1020; color:#e6edf3; line-height:1.6;"></div>
                    <pre id="viewer-pre"
                        style="margin:0; padding:0; background:#0b1020; color:#e6edf3; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 13px; line-height: 1.6; white-space: pre;">
                    </pre>
                </div>
                <div id="viewer-hint" class="hint" style="padding:8px 12px; border-top:1px solid #25304a;"></div>
            </div>
        </div>

        <div id="upload-zone" class="dropzone">
            拖拽文件到此处上传，或点击上方“选择文件上传”<br />
            <span class="hint">上传会使用 HTTP PUT 到当前目录；如需重名覆盖请确认服务端允许</span>
        </div>

        <p class="hint">说明：页面优先使用 WebDAV 方法（PROPFIND/PUT/MOVE/DELETE）。若服务端未启用 WebDAV，将尝试解析目录索引 HTML
            获取列表；但重命名/删除需服务端支持相应方法。</p>
    </div>
    <script type="module" src="./main.js"></script>
</body>

</html>